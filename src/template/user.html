{% extends "base.html" %}

{% block imports %}
<script src="/js/athlete.js" type="text/javascript"></script>
{% endblock %}

{% block tabs %}
<st:tab code="sessions" label="Sessions"/>
<st:tab code="fitness" label="Fitness progress"/>
<st:tab code="gear" label="Gear"/>
<st:tab code="profile" label="Profile"/>
<st:tab code="history" label="Health History"/>
<st:tab code="st" label="Session Types"/>
<st:tab code="gt" label="Gear Types"/>
{% endblock tabs %}

{% block mainpage %}
        <div id="page_profile" class="tabpage" hidden="true">
            <st:form name="profile" url="/json/athlete">
                <st:field id="email" type="text" property="email" label="Email" readonly="true"/>
                <st:field id="name" type="text" property="name" label="Name" required="true"/>
                <st:field id="country" type="choice" property="country" label="Country" url="/config/json/country" key="code" text="name"/>
                <st:field id="gender" type="choice" presentationtype="radio" property="gender" label="Gender" value="M">
                    <st:value key="M" text="Male"/>
                    <st:value key="F" text="Female"/>
                </st:field>
                <st:field id="height" type="length" property="height" label="Height"/>
                <st:field id="dob" type="date" property="dob" label="Date of Birth"/>
                <st:field id="units" type="choice" presentationtype="radio" property="units" label="Preferred Units" value="metric">
                    {% for u in units %}
                        <st:value key="{{ u }}" text="{{u|title}}"/>
                    {% endfor %}
                </st:field>
                <st:footer>
                    <st:action mode="view" label="Edit" action="edit"/>
                    <st:action mode="edit" label="Save" action="save"/>
                    <st:action mode="edit" label="Cancel" action="cancel"/>
                </st:footer>
            </st:form>
	</div>

        <div id="page_sessions" class="tabpage" hidden="true">
            <st:table name="sessions" url="/json/sessions">
                <st:header>
                    <st:action label="Upload session" action="upload"/>
                    <st:action label="Enter session" action="enterSession"/>
                </st:header>
                <st:column label="" type="icon" property="interval.type" width="5%"/>
                <st:column label="Date" type="date" property="start" width="15%"/>
                <st:column label="Title" get="makeSessionLink" width="55%"/>
                <st:column label="Distance" type="distance" property="interval.distance" width="15%"/>
                <st:column label="Duration" type="time" property="interval.seconds" width="10%"/>
            </st:table>
            <st:form name="upload" popup="true" url="/upload/file" submit="form">
                <st:field id="datafile" type="file" label="Datafile" onchange="fileSelected"/>
                <st:field id="description" type="text" label="Description"/>
                <st:field id="timestamp" type="datetime" label="Date/time"/>
                <st:action mode="new" label="Upload" action="startUpload"/>
                <st:action mode="new" label="Cancel" action="cancel"/>
            </st:form>
        </div>

            <div id="page_fitness" class="tabpage" hidden="true">
                <div id="bikefitness" class="pagebox">
		    <st:table name="ftphistory" url="/json/history" onrender="setCurrentFTP" onrendered="showCurrentFTP">
                        <st:header>
                            <st:action name="updateftp" action="html">
                                <img id="sessiontype" src="/images/bike.png" height="48" width="48"/>
                                Current FTP: <span id="current_ftp" style="font-weight: bold"></span>&#160;
                                <a id="update_ftp_link" class="menulink" href="#" onclick="updateFTP();">Update</a>
                            </st:action>
                        </st:header>
                        <st:datasource url="/json/ftp_history"/>
			<st:column label="Date" type="date" property="ftpdate" select="true"/>
			<st:column label="FTP (W)" type="integer" property="power"/>
                        <st:dataform name="newftp" url="/json/ftp_history" onsubmitted="renderFTPTable">
                            <st:field id="ftpdate" type="date" property="ftpdate" label="Date"/>
                            <st:field id="ftp" property="power" label="FTP (W)" size="4"/>
                            <st:action mode="view" label="Edit" action="edit"/>
                            <st:action mode="edit;new" label="Save" action="save"/>
                            <st:action mode="view;edit;new" label="Cancel" action="cancel"/>
                        </st:dataform>
		    </st:table>
                </div>
            </div>

            <div id="page_history" class="tabpage" hidden="true">
                <st:table name="history" url="/json/history">
                    <st:column label="Date" type="date" property="snapshotdate" select="true"/>
                    <st:column label="Weight" type="weight" property="weight"/>
                    <st:column label="Bodyfat %" property="bfPercentage" type="float" digits="1"/>
                    <st:column label="Waist" type="length" property="waist"/>
                    <st:column label="BMI" property="bmi" type="float" digits="2"/>
                    <st:dataform>
                        <st:field id="snapshotdate" type="date" property="snapshotdate" label="Date"/>
                        <st:field id="weight" type="weight" property="weight" label="Weight"/>
                        <st:field id="bodyfat" type="text" size="4" maxlength="5" property="bfPercentage" label="Bodyfat %"/>
                        <st:field id="waist" type="length" property="waist" label="Waist"/>
                        <st:action mode="view" label="Edit" action="edit"/>
                        <st:action mode="new;edit" label="Save" action="save"/>
                        <st:action mode="view;new;edit" label="Cancel" action="cancel"/>
                    </st:dataform>
                    <st:action label="Add" action="new"/>
                </st:table>
	    </div>

            <div id="page_gear" class="tabpage" hidden="true">
		GEAR
	    </div>

            <div id="page_st" class="tabpage" hidden="true">
                <st:treeview name="sessiontypes" url="/json/sessiontypes" display="name" children="subTypes">
                    <st:dataform initialize="init_new_sub_st">
                        <st:field id="name" type="text" label="Name"/>
                        <st:field id="subTypeOf.name" type="text" label="Subtype of" readonly="true"/>
                        <st:field id="trackDistance" type="checkbox" label="Track Distance"/>
                        <st:field id="speedPace" type="choice" presentationtype="radio" label="Show pace/speed" value="Speed">
                            <st:value key="Speed" text="Speed"/>
                            <st:value key="Pace" text="Pace"/>
                            <st:value key="Swim Pace" text="Swim Pace"/>
                        </st:field>
                        <st:action mode="view" label="Edit" action="edit"/>
                        <st:action mode="view" label="New Subtype" action="new_sub_st"/>
                        <st:action mode="new;edit" label="Save" action="save"/>
                        <st:action mode="view;new;edit" label="Cancel" action="cancel"/>
                    </st:dataform>
                </st:treeview>
	    </div>

            <div id="page_gt" class="tabpage" hidden="true">
                <st:treeview name="geartypes" url="/json/geartypes" display="name" children="subTypes">
                    <st:dataform initialize="init_new_sub_gt">
                        <st:field id="name" type="text" label="Name"/>
                        <st:field id="isA.name" type="text" label="Is a" readonly="true"/>
                        <st:field id="partOf.name" type="text" label="Part of"/>
                        <st:field id="usedFor.name" type="text" label="Used for"/>
                        <st:action mode="view" label="Edit" action="edit"/>
                        <st:action mode="view" label="New Subtype" action="new_sub_gt"/>
                        <st:action mode="new;edit" label="Save" action="save"/>
                        <st:action mode="view;new;edit" label="Cancel" action="cancel"/>
                    </st:dataform>
                </st:treeview>
	    </div>
{% endblock mainpage %}
